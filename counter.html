<!DOCTYPE HTML>
<html lang="en">

  <head>
      <meta charset="UTF-8">
      <meta name="robots" content="index,follow,archive">
      <meta name="keywords" content="NIL">
      <link rel="stylesheet" type="text/css" href="style.css"/>
      <title>Counters and Ramps</title>
      <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
      <link href='https://fonts.googleapis.com/css?family=PT+Serif' rel='stylesheet' type='text/css'/>
      <link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'/>
  </head>
  
<body lang="en-US">
  <a id="top"></a>
  <a href=index.html class="link">Home</a> &nbsp;<a href=generators.html class="navigation">Previous: generators </a> &nbsp;<a href=envelope.html class="navigation">Next: envelope </a> &nbsp;<a href=contents.html class="navigation">Contents </a> &nbsp;
  <hr style='height:4px;border-width:0;color:green;background-color:gray'/>
  <img class="center" src="images/counter.png" alt="counter"/>
  <h1 class="banner">Counters and Ramps</h1>
  <a id="counter"></a>
  <p class="body">
    A COUNTER is a <a href='generators.html'>generator</a> which produces
    integer linear sequences. For non-integer values either specify a value-hook function or use a <a href='#ramp'>ramp</a> generator.
  </p>
  
  <!-- (COUNTER from to &key by hook monitor action) -->
  <!--  -->
  <!--  -->
  <b class="definition">(COUNTER from to &key by hook monitor action)</b><br>
  <p class="summery">Returns new counter generator</p>
  <pre class="description">
    
    from - Initial integer value.
    to   - Final integer value, to &ne; from
    :by      - Integer increment.  The increment sign is automatically adjusted 
               for compatibility with the from and to values.  Defaults to &pm;1.
    :hook    - Function applied to the internal value.  
               The VALUE function returns the internal-value processed by the 
               hook function.  Default (lambda (n) n)
    :monitor - Value monitor predicate called by NEXT-1.  If the monitor returns
               non-nil the action function is executed.
               Default (lambda (value) nil)
    :action  - Function executed within NEXT-1 if the monitor function is
               non-nil.  The function form is (lambda (counter value))
               and it returns the next internal value.  The internal state 
               of the counter may be modified as a side-effect.  
               Default (lambda (counter value) value)
    
    
    Examples
    
    (param foo (counter 0 9))
    (next foo 12) &rarr; (0 1 2 3 4 5 6 7 8 9 9 9) 
    
    (param foo2 (counter 0 5 :hook (lambda (n)(+ (* n n) 0.5))))
    (next foo2 6) &rarr; (0.5 1.5 4.5 9.5 16.5 25.5 25.5)
     
    ;; Using monitor/action to skip values
    ;;
       
    (param foo3 (counter 0 9
    		     :monitor #'(lambda (n)(= n 3))
    		     :action #'(lambda (counter n)
    				 (declare (ignore counter))
    				 (+ n 3))))
    				 
    (next foo3 7) &rarr; (0 1 2 6 7 8 9) 
     
    ;; Dynamically change internal state
    ;; 
    (param foo4 (counter 0 100 :by 2
    		     :monitor #'(lambda (n)(= n 10))
    		     :action #'(lambda (counter n)
    				 (setf (counter-increment counter) 10)
    				 n)))
    
    (next foo4 15) &rarr; (0 2 4 6 8 10 20 30 40 50 60 70 80 90 100) 
    
    ;; Produce cyclical output
    ;; 
    (param foo5 (counter 0 5
    		     :monitor #'(lambda (n)(= n 5))
    		     :action #'(lambda (counter n)
    				 (declare (ignore counter n))
    				 0)))
    
    (next foo5 15) &rarr; (0 1 2 3 4 0 1 2 3 4 0 1 2 3 4)
  </pre>
  <hr style='height:4px;border-width:0;color:green;background-color:gray'/>
  <a id="ramp"></a>
  
  <!-- (RAMP a b &key by hook monitor action) -->
  <!--  -->
  <!--  -->
  <b class="definition">(RAMP a b &key by hook monitor action)</b><br>
  <p class="summery">Returns new RAMP generator.</p>
  <pre class="description">
    A RAMP is similar to a counter with the following exceptions.
    
    1) Ramps may use non-integers
    2) It is more difficult to use monitor/action to change the next value generated.
    
    a   - Number, initial value
    b   - Number, final value, a &ne; b
    :by - Number, increment.  The increment sign is automatically adjusted to the 
          a and b values, default &pm;1.
    :hook    - Function applied to internal-value, default (lambda (n) n)
    :monitor - Function, predicate called within NEXT-1.  If the result is
               non-nil the action function is executed.  Default (lambda (v) nil)
    :action  - Function executed within NEXT-1 whenever monitor is non-nil.
               Default (lambda (ramp) nil).  The return value is not used.
    
    Examples
    
    (param foo (ramp 0 5 :by 1/2))
    (next foo 12) &rarr; (0 1/2 1 3/2 2 5/2 3 7/2 4 9/2 5 5) 
    
    
    ;; Using monitor/action for side-effect
    
    (param foo2 (ramp 0 -9 
    		  :monitor #'(lambda (n)(= n -5))
    		  :action #'(lambda (ramp)
    			      (declare (ignore ramp))
    			      (print 'FIRE))))
    
    (next foo2 5) &rarr; (0 -1 -2 -3 -4) 
    (next foo2) &rarr; FIRE -5
    (next foo2 5) &rarr; (-6 -7 -8 -9 -9) 
  </pre>
  <hr style='height:4px;border-width:0;color:green;background-color:gray'/>
  <a href=index.html class="link">Home</a> &nbsp;<a href=generators.html class="navigation">Previous: generators </a> &nbsp;<a href=envelope.html class="navigation">Next: envelope </a> &nbsp;<a href=#top class="navigation">Top </a> &nbsp;<a href=contents.html class="navigation">Contents </a> &nbsp;
  
</body>
</html>